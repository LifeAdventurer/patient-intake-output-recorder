<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="./manifest.json" />

    <title>Patient Intake/Output Recorder</title>

    <link rel="icon" href="../images/PIOR_logo-512x512.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css"
      integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <div id="app" class="container">
      <div
        v-if="bootstrapAlertMessage"
        :class="['alert', bootstrapAlertClass, 'alert-dismissible', 'fade', 'show']"
        role="alert"
        style="
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 1056;
          min-width: 200px;
        "
      >
        {{ bootstrapAlertMessage }}
        <button
          type="button"
          class="btn-close"
          @click="bootstrapAlertMessage = ''"
          aria-label="Close alert"
        ></button>
      </div>

      <template v-if="!authenticated">
        <div class="row mt-4">
          <div class="col text-center">
            <h1>護理站數據監測</h1>
          </div>
        </div>
        <div class="row justify-content-center mt-4">
          <div class="col-md-6 col-lg-5 col-xl-4">
            <div class="card shadow-sm">
              <div class="card-body p-4">
                <h5 class="card-title text-center mb-4">管理員登入</h5>
                <div class="input-group mb-3">
                  <span class="input-group-text" id="account-addon"
                    ><i class="fas fa-user"></i
                  ></span>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="帳號"
                    aria-label="帳號"
                    aria-describedby="account-addon"
                    v-model.trim="account"
                  />
                </div>
                <div class="input-group mb-3">
                  <span class="input-group-text" id="password-addon"
                    ><i class="fas fa-lock"></i
                  ></span>
                  <input
                    :type="showPassword ? 'text' : 'password'"
                    class="form-control"
                    placeholder="密碼"
                    aria-label="密碼"
                    aria-describedby="password-addon"
                    v-model="password"
                    @keyup.enter="authenticate"
                  />
                  <button
                    class="btn btn-light border"
                    type="button"
                    @click="togglePasswordVisibility"
                    title="顯示/隱藏密碼"
                  >
                    <i
                      class="fa-solid"
                      :class="showPassword ? 'fa-eye-slash' : 'fa-eye'"
                      aria-hidden="true"
                    ></i>
                  </button>
                </div>
                <div class="d-grid">
                  <button
                    class="btn btn-primary"
                    @click="authenticate"
                    :disabled="!account || !password"
                  >
                    <i class="fas fa-sign-in-alt me-2"></i>登入
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </template>

      <template v-else>
        <div
          class="row align-items-center mb-3 sticky-top bg-light py-2 shadow-sm"
          style="z-index: 1030"
        >
          <div
            class="col-6 col-md-3 col-lg-3 fw-bold fs-6 text-nowrap text-secondary"
          >
            <i class="fas fa-calendar-alt me-1"></i> {{ currentDate }}
          </div>

          <div class="col-12 col-md-3 col-lg-3 order-md-2 order-3 mt-2 mt-md-0">
            <div class="input-group input-group-sm">
              <span class="input-group-text"
                ><i class="fa-solid fa-search"></i
              ></span>
              <input
                type="search"
                class="form-control"
                v-model="searchQuery"
                placeholder="依病床號搜尋..."
                aria-label="Search patient"
              />
            </div>
          </div>

          <div
            class="col-12 col-md-4 col-lg-4 order-md-3 order-4 mt-2 mt-md-0 d-flex gap-2"
          >
            <button
              class="btn btn-sm btn-outline-primary"
              data-bs-toggle="modal"
              data-bs-target="#manageModal"
              title="管理病患"
            >
              <i class="fas fa-users-cog me-1"></i> 管理
            </button>
            <button
              class="btn btn-sm btn-outline-success"
              data-bs-toggle="modal"
              data-bs-target="#signUpModal"
              title="註冊新病患"
            >
              <i class="fas fa-user-plus me-1"></i> 註冊
            </button>
            <button
              class="btn btn-sm btn-outline-danger"
              @click="confirmLogout"
              title="登出"
            >
              <i class="fas fa-sign-out-alt me-1"></i> 登出 {{ account }}
            </button>
          </div>

          <div
            class="col-6 col-md-2 col-lg-2 order-md-4 order-2 text-end fw-bold fs-6 text-nowrap text-secondary"
          >
            <i class="fas fa-clock me-1"></i> {{ currentTime }}
          </div>
        </div>

        <!-- Patient Records -->
        <div
          class="row justify-content-start row-cols-1 row-cols-lg-2 g-4 mb-5"
        >
          <div
            v-for="patientAccount in filteredPatientAccounts"
            :key="patientAccount"
          >
            <div v-if="patientRecords[patientAccount]" class="col">
              <div class="card shadow h-100">
                <div
                  class="card-body d-flex flex-column"
                  style="padding-top: 10px"
                >
                  <div class="row">
                    <h3 class="col-3 card-title mb-3">{{ patientAccount }}</h3>
                    <div class="col-1 mt-1">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="30"
                        height="30"
                        fill="currentColor"
                        style="cursor: pointer"
                        class="bi bi-qr-code-scan"
                        viewBox="0 0 16 16"
                        @click="openQrCodeModal(patientAccount)"
                      >
                        <path
                          d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z"
                        />
                        <path d="M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z" />
                        <path d="M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z" />
                        <path
                          d="M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z"
                        />
                        <path d="M12 9h2V8h-2z" />
                      </svg>
                    </div>
                    <div class="col input-group mb-3">
                      <template v-if="patientRecords[patientAccount].isEditing">
                        <div class="input-group-text bg-light border-primary">
                          <div class="form-check form-check-inline me-2 mb-0">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              :id="`food-checkbox-${patientAccount}`"
                              v-model="patientRecords[patientAccount].foodCheckboxChecked"
                            />
                            <label
                              class="form-check-label small"
                              :for="`food-checkbox-${patientAccount}`"
                              >吃</label
                            >
                          </div>
                          <div class="form-check form-check-inline mb-0">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              :id="`water-checkbox-${patientAccount}`"
                              v-model="patientRecords[patientAccount].waterCheckboxChecked"
                            />
                            <label
                              class="form-check-label small"
                              :for="`water-checkbox-${patientAccount}`"
                              >水</label
                            >
                          </div>
                        </div>
                        <input
                          v-model.number="patientRecords[patientAccount].limitAmount"
                          @input="handleRestrictionInput($event, patientAccount)"
                          type="number"
                          min="0"
                          step="any"
                          class="form-control form-control-sm border-primary"
                          placeholder="限制量 (g/ml)"
                          aria-label="飲食限制量"
                          required
                        />
                      </template>
                      <input
                        v-else
                        :value="restrictionText[patientAccount] || '無限制'"
                        type="text"
                        class="form-control form-control-sm text-center"
                        :class="{'bg-warning bg-opacity-25': restrictionText[patientAccount] }"
                        aria-label="目前飲食限制"
                        readonly
                      />
                      <button
                        class="btn"
                        :class="patientRecords[patientAccount].isEditing ? 'btn-secondary' : 'btn-outline-primary'"
                        @click="toggleRestrictionEdit(patientAccount)"
                      >
                        <i
                          :class="patientRecords[patientAccount].isEditing ? 'fa-solid fa-check' : 'fa-solid fa-pencil-alt'"
                        ></i>
                      </button>
                    </div>
                  </div>

                  <div class="mb-3">
                    <h6 class="text-muted small mb-1">今日總計</h6>
                    <div
                      v-if="patientRecords[patientAccount][currentDateYYYY_M_D]"
                      class="border rounded p-2 bg-light"
                    >
                      <div class="row gx-2 text-center small">
                        <div class="col" title="進食總量">
                          <span
                            :class="getFoodSumColor(patientAccount) === 'red' ? 'text-danger fw-bold' : ''"
                          >
                            <i class="fas fa-utensils me-1"></i> {{
                            patientRecords[patientAccount][currentDateYYYY_M_D].foodSum
                            ?? 0 }}g
                          </span>
                        </div>
                        <div class="col border-start" title="飲水總量">
                          <span
                            :class="getWaterSumColor(patientAccount) === 'red' ? 'text-danger fw-bold' : ''"
                          >
                            <i class="fas fa-glass-water me-1"></i> {{
                            patientRecords[patientAccount][currentDateYYYY_M_D].waterSum
                            ?? 0 }}ml
                          </span>
                        </div>
                        <div class="col border-start" title="排尿總量">
                          <i class="fas fa-toilet me-1"></i> {{
                          patientRecords[patientAccount][currentDateYYYY_M_D].urinationSum
                          ?? 0 }}ml
                        </div>
                        <div class="col border-start" title="排便次數">
                          <i class="fas fa-poop me-1"></i> {{
                          patientRecords[patientAccount][currentDateYYYY_M_D].defecationSum
                          ?? 0 }}次
                        </div>
                      </div>
                    </div>

                    <div v-else class="text-center text-muted small p-2">
                      (今日尚無紀錄)
                    </div>
                  </div>

                  <div
                    class="accordion flex-grow-1"
                    :id="`accordion-${patientAccount}`"
                  >
                    <div class="accordion-item">
                      <h2
                        class="accordion-header"
                        :id="`header-all-${patientAccount}`"
                      >
                        <button
                          class="accordion-button collapsed py-2"
                          type="button"
                          data-bs-toggle="collapse"
                          :data-bs-target="`#collapse-all-${patientAccount}`"
                          aria-expanded="false"
                          :aria-controls="`collapse-all-${patientAccount}`"
                        >
                          <span class="fw-bold me-auto">所有紀錄</span>
                          <small class="text-muted">
                            {{ getFirstAndLastDates(patientAccount) }}
                          </small>
                        </button>
                      </h2>
                      <div
                        :id="`collapse-all-${patientAccount}`"
                        class="accordion-collapse collapse"
                        :aria-labelledby="`header-all-${patientAccount}`"
                        :data-bs-parent="`#accordion-${patientAccount}`"
                      >
                        <div
                          class="accordion-body p-0"
                          style="max-height: 40vh; overflow-y: auto"
                        >
                          <div
                            class="accordion"
                            :id="`accordion-daily-${patientAccount}`"
                          >
                            <template
                              v-if="Object.keys(reversedPatientRecords[patientAccount] || {}).length > 0"
                            >
                              <div
                                class="accordion-item border-0 border-bottom"
                                v-for="(dailyRecord, dateKey) in reversedPatientRecords[patientAccount]"
                              >
                                <h2
                                  class="accordion-header"
                                  :id="`header-${dateKey}`"
                                >
                                  <button
                                    class="accordion-button collapsed py-2"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    :data-bs-target="`#collapse-${dateKey}-${patientAccount}`"
                                    aria-expanded="false"
                                    :aria-controls="`#collapse-${dateKey}-${patientAccount}`"
                                  >
                                    <div
                                      class="d-flex w-100 justify-content-between align-items-center small"
                                    >
                                      <span class="fw-bold">
                                        {{ dailyRecord.recordDate }}
                                      </span>
                                      <span
                                        class="fw-bold me-2"
                                        title="當日體重"
                                      >
                                        <i class="fas fa-weight-scale me-1"></i>
                                        {{ dailyRecord.weight === 0 ? '未測量' :
                                        `${dailyRecord.weight} kg` }}
                                      </span>
                                      <span class="fw-bold">
                                        {{ dailyRecord.count ?? 0 }}筆紀錄
                                      </span>
                                    </div>
                                  </button>
                                </h2>

                                <div
                                  :id="`collapse-${dateKey}-${patientAccount}`"
                                  class="accordion-collapse collapse"
                                  :aria-labelledby="`header-${dateKey}`"
                                  :data-bs-parent="`#accordion-daily-${patientAccount}`"
                                >
                                  <div class="accordion-body p-2">
                                    <div class="table-responsive">
                                      <table
                                        class="table table-sm table-hover table-bordered mb-0 small"
                                      >
                                        <thead class="table-light">
                                          <tr class="text-center">
                                            <th>時間</th>
                                            <th>
                                              <i
                                                class="fas fa-utensils"
                                                title="進食 (g)"
                                              ></i>
                                            </th>
                                            <th>
                                              <i
                                                class="fas fa-glass-water"
                                                title="喝水 (ml)"
                                              ></i>
                                            </th>
                                            <th>
                                              <i
                                                class="fas fa-toilet"
                                                title="排尿 (ml)"
                                              ></i>
                                            </th>
                                            <th>
                                              <i
                                                class="fas fa-poop"
                                                title="排便 (次)"
                                              ></i>
                                            </th>
                                            <th>
                                              <i
                                                class="fas fa-edit"
                                                title="操作"
                                              ></i>
                                            </th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <tr
                                            v-for="(recordData, recordIndex) in dailyRecord.data"
                                            :key="recordIndex"
                                          >
                                            <td
                                              v-for="(content, columnIndex) in recordData"
                                              class="text-center align-middle"
                                              :key="columnIndex"
                                            >
                                              <input
                                                v-if="columnIndex !== 'time' && editingRecordPatientAccount === patientAccount && editingRecordIndex === recordIndex"
                                                class="form-control"
                                                type="number"
                                                v-model="dailyRecord.data[recordIndex][columnIndex]"
                                              />
                                              <span v-else>
                                                {{ content }}
                                              </span>
                                            </td>
                                            <td
                                              class="text-center align-middle"
                                            >
                                              <button
                                                class="btn btn-sm btn-link p-0 me-1"
                                                @click="toggleRecordEdit($event.target, patientAccount)"
                                              >
                                                <i
                                                  class="fas fa-fw"
                                                  :class="editingRecordPatientAccount ? 'fa-check text-success' : 'fa-pen-to-square text-primary'"
                                                  :id="`${dateKey}-${recordIndex}`"
                                                >
                                                </i>
                                              </button>
                                              <button
                                                class="btn btn-sm btn-link p-0"
                                                @click="removeRecord($event.target, patientAccount)"
                                              >
                                                <i
                                                  class="fa-solid"
                                                  :class="removingRecord ? 'fa-hourglass-half' : 'fa-trash-can text-danger'"
                                                  :id="`${dateKey}-${recordIndex}`"
                                                >
                                                </i>
                                              </button>
                                            </td>
                                          </tr>
                                          <tr
                                            class="table-light text-center fw-bold"
                                          >
                                            <td>總計</td>
                                            <td>
                                              {{ dailyRecord.foodSum ?? 0 }}
                                            </td>
                                            <td>
                                              {{ dailyRecord.waterSum ?? 0 }}
                                            </td>
                                            <td>
                                              {{ dailyRecord.urinationSum ?? 0
                                              }}
                                            </td>
                                            <td>
                                              {{ dailyRecord.defecationSum ??
                                              0}}
                                            </td>
                                            <td></td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </template>
                            <template v-else>
                              <div class="text-center p-3 text-muted">
                                (無歷史紀錄)
                              </div>
                            </template>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <button
          class="btn btn-dark position-fixed bottom-0 end-0 m-3 rounded-circle shadow"
          style="width: 40px; height: 40px; line-height: 1; padding: 0"
          id="scrollToTopBtn"
          @click="scrollToTop"
          v-show="showScrollButton"
          title="回到頂部"
        >
          <i class="fa-solid fa-arrow-up"></i>
        </button>

        <!-- Sign up Modal -->
        <div
          class="modal fade"
          id="signUpModal"
          tabindex="-1"
          data-bs-backdrop="static"
          aria-labelledby="signUpModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="signUpModalLabel">
                  <i class="fas fa-user-plus me-2"></i>註冊新病患帳號
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="關閉"
                  @click="resetSignUpForm()"
                ></button>
              </div>
              <div class="modal-body">
                <div
                  v-if="signUpAlertMessage"
                  :class="['alert', 'alert-sm', signUpAlertClass]"
                  role="alert"
                >
                  {{ signUpAlertMessage}}
                </div>

                <form
                  id="signUpForm"
                  @submit.prevent="signUpPatient"
                  :class="{ 'was-validated' : signUpPatientSubmitted }"
                  novalidate
                >
                  <div class="mb-3">
                    <label for="signUpPatientAccount" class="form-label"
                      >病患帳號</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="signUpPatientAccount"
                      v-model.trim="signUpPatientAccount"
                      required
                      pattern=".*\S.*"
                      aria-describedby="accountHelpBlock"
                    />
                    <div id="accountHelpBlock" class="form-text small">
                      建議使用容易識別的唯一代號，例如病床號。
                    </div>
                    <div class="invalid-feedback">
                      請輸入有效的帳號 (不能只包含空白字元)。
                    </div>
                  </div>
                  <div class="mb-3">
                    <label for="signUpPatientPassword" class="form-label">
                      病患密碼
                    </label>
                    <input
                      type="text"
                      class="form-control"
                      id="signUpPatientPassword"
                      v-model="signUpPatientPassword"
                      required
                      aria-describedby="passwordHelpBlock"
                    />
                    <div id="passwordHelpBlock" class="form-text small">
                      此密碼供病患或家屬透過 QR Code 登入記錄，請妥善告知。
                    </div>
                    <div class="invalid-feedback">請輸入密碼。</div>
                  </div>
                  <div class="mb-3">
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="autoAddToMonitor"
                        v-model="autoAddToMonitor"
                      />
                      <label class="form-check-label" for="autoAddToMonitor">
                        自動將註冊的病患加入監控名單
                      </label>
                    </div>
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="stayOpenAfterSignup"
                        v-model="stayOpenAfterSignup"
                      />
                      <label class="form-check-label" for="stayOpenAfterSignup">
                        註冊成功後保持此視窗開啟 (方便連續註冊)
                      </label>
                    </div>
                  </div>
                  <div class="d-flex justify-content-end">
                    <button
                      type="button"
                      class="btn btn-secondary me-2"
                      data-bs-dismiss="modal"
                      @click="resetSignUpForm()"
                    >
                      取消
                    </button>
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-check me-1"></i>註冊
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Manage Modal -->
        <div
          class="modal fade"
          id="manageModal"
          tabindex="-1"
          data-bs-backdrop="static"
          aria-labelledby="manageModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="manageModalLabel">
                  <i class="fas fa-users-cog me-2"></i>管理病患
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="關閉"
                ></button>
              </div>
              <div class="modal-body">
                <div class="mb-4">
                  <h6 class="mb-2 text-muted">
                    <i class="fas fa-eye-slash me-1"></i> 未監測病患
                  </h6>
                  <div
                    class="list-group list-group-flush"
                    style="max-height: 25vh; overflow-y: auto"
                  >
                    <div
                      class="list-group-item d-flex justify-content-between align-items-center"
                      v-for="patient in unmonitoredPatients"
                      :key="`unmon-${patient}`"
                    >
                      <span class="fw-bold">{{ patient }}</span>
                      <button
                        class="btn btn-success btn-sm"
                        @click="addPatientToMonitor(patient)"
                      >
                        <i class="fas fa-plus me-1"></i> 加入監測
                      </button>
                    </div>
                    <div
                      v-if="!unmonitoredPatients || unmonitoredPatients.length === 0"
                      class="list-group-item text-center text-muted"
                    >
                      (無未監測病患)
                    </div>
                  </div>
                </div>

                <div>
                  <h6 class="mb-2 text-muted">
                    <i class="fas fa-eye me-1"></i> 監測中病患
                  </h6>
                  <div
                    class="list-group list-group-flush"
                    style="max-height: 35vh; overflow-y: auto"
                  >
                    <div
                      class="list-group-item d-flex flex-column flex-sm-row justify-content-between align-items-center"
                      v-for="patient in monitoredPatientAccounts"
                      :key="`mon-${patient}`"
                    >
                      <span class="fw-bold mb-2 mb-sm-0">{{ patient }}</span>
                      <div
                        class="btn-group btn-group-sm flex-wrap"
                        role="group"
                      >
                        <button
                          class="btn btn-outline-primary"
                          @click="openTransferModal(patient)"
                        >
                          <i class="fas fa-exchange-alt me-1"></i> 轉移資料
                        </button>
                        <button
                          class="btn btn-outline-secondary"
                          @click="clearPatientData(patient)"
                        >
                          <i class="fas fa-eraser me-1"></i> 清除紀錄
                        </button>
                        <button
                          class="btn btn-outline-warning"
                          @click="removePatientFromMonitor(patient)"
                        >
                          <i class="fas fa-minus-circle me-1"></i> 取消監測
                        </button>
                        <button
                          class="btn btn-outline-danger"
                          @click="deletePatient(patient)"
                        >
                          <i class="fas fa-user-times me-1"></i> 出院 (刪除)
                        </button>
                      </div>
                    </div>
                    <div
                      v-if="!monitoredPatientAccounts || monitoredPatientAccounts.length === 0"
                      class="list-group-item text-center text-muted"
                    >
                      (無監測中病患)
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- QR Code Modal -->
        <div
          class="modal fade"
          id="qrCodeModal"
          tabindex="-1"
          aria-labelledby="qrCodeModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="qrCodeModalLabel">
                  QR Code for {{ qrCodePatient }}
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="關閉"
                ></button>
              </div>
              <div class="modal-body text-center">
                <p class="text-muted">請病患或家屬掃描此 QR Code 登入記錄：</p>
                <div
                  class="d-flex justify-content-center mb-3"
                  id="qrCodeContainer"
                ></div>
                <!-- <div class="alert alert-info alert-sm small"> -->
                <!--   <p class="mb-1"> -->
                <!--     <strong>登入網址:</strong> -->
                <!--     <a :href="webUrl + '/patient/'" target="_blank" -->
                <!--       >{{ webUrl }}/patient/</a -->
                <!--     > -->
                <!--   </p> -->
                <!--   <p class="mb-1"><strong>帳號:</strong> {{ qrCodePatient }}</p> -->
                <!--   <p class="mb-0"> -->
                <!--     <strong>密碼:</strong> {{ qrCodePatientPassword }} -->
                <!--   </p> -->
                <!-- </div> -->
              </div>
              <div class="modal-footer justify-content-center">
                <button
                  type="button"
                  class="btn"
                  @click="copyQrCodeImage($event)"
                >
                  <i class="fas fa-copy"></i>
                </button>
                <button type="button" class="btn" @click="printQrCode">
                  <i class="fas fa-print"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Transfer Data Modal -->
        <div
          class="modal fade"
          id="transferModal"
          tabindex="-1"
          data-bs-backdrop="static"
          aria-labelledby="transferModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="transferModalLabel">
                  <i class="fas fa-exchange-alt me-2"></i>轉移病患資料
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                ></button>
              </div>
              <div class="modal-body">
                <p>
                  請輸入要將
                  <strong>{{ transferFrom }}</strong> 的資料轉移到哪個帳號：
                </p>
                <div class="mb-3">
                  <label for="transferToAccount" class="form-label"
                    >目標病患帳號 (監測中)</label
                  >
                  <input
                    type="text"
                    list="monitored-patients-list"
                    class="form-control"
                    id="transferToAccount"
                    v-model.trim="transferTo"
                    placeholder="輸入目標病患帳號"
                    required
                  />
                  <datalist id="monitored-patients-list">
                    <option
                      v-for="pAcc in monitoredPatientAccounts"
                      :key="`datalist-${pAcc}`"
                      :value="pAcc"
                    ></option>
                  </datalist>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">
                  取消
                </button>
                <button class="btn btn-primary" @click="transferPatientData">
                  確認轉移
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Bootstrap Confirm Modal -->
        <div
          class="modal fade"
          id="confirmModal"
          tabindex="-1"
          data-bs-backdrop="static"
          aria-labelledby="confirmModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">
                  <i class="fas fa-question-circle me-2 text-warning"></i>請確認
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  @click="handleConfirm(false)"
                ></button>
              </div>
              <div class="modal-body">
                <p style="white-space: pre-wrap">{{ confirmMessage }}</p>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                  @click="handleConfirm(false)"
                >
                  取消
                </button>
                <button
                  type="button"
                  class="btn btn-danger"
                  data-bs-dismiss="modal"
                  @click="handleConfirm(true)"
                >
                  確認
                </button>
              </div>
            </div>
          </div>
        </div>
      </template>

      <footer
        v-if="!authenticated"
        class="footer py-3 bg-white fixed-bottom border-top"
      >
        <div class="container text-center text-md-start">
          <div class="row align-items-center">
            <div class="col-md-5 text-muted small">
              © 2023–2025 LifeAdventurer | All rights reserved
            </div>
            <div class="col-md-3 text-muted small">
              Code licensed
              <a
                href="https://github.com/LifeAdventurer/patient-intake-output-recorder/blob/main/LICENSE"
                target="_blank"
                rel="noopener noreferrer"
                >GPL-3.0</a
              >
            </div>
            <div class="col-md-2 text-muted small">
              Version: <strong>v1.2.0</strong>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.5.12/vue.global.min.js"
      integrity="sha512-GQnkp3HbW6BBv2mlZ7ZmzEfJcoaTJSMKBjORQCknW8HbkyV5gmJKSpDp1LLXdJDaZg+pH4/Hx5isR8Eyx6YYsQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"
      integrity="sha512-2rNj2KJ+D8s1ceNasTIex6z4HWyOnEYLVC3FigGOmyQCZc2eBXKgOxQmo3oKLHyfcj53uz4QMsRCWNbLd32Q1g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js"
      integrity="sha512-ykZ1QQr0Jy/4ZkvKuqWn4iF3lqPZyij9iRv6sGqLRdTPkY69YX6+7wvVGmsdBbiIfN/8OdsI7HABjvEok6ZopQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"
      integrity="sha512-ZDSPMa/JM1D+7kdg2x3BsruQ6T/JpJo3jWDWkCZsP+5yVyp1KfESqLI+7RqB5k24F7p2cV7i2YHh/890y6P6Sw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="./script.js"></script>
  </body>
</html>
