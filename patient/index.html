<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="./manifest.json" />

    <title>Patient Intake/Output Recorder</title>

    <link rel="icon" href="../images/PIOR_logo-512x512.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css"
      integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <div id="app" class="container">
      <div
        v-if="bootstrapAlertMessage"
        :class="['alert', bootstrapAlertClass, 'alert-dismissible', 'fade', 'show']"
        role="alert"
        style="
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 1056;
          min-width: 200px;
        "
      >
        <i class="fas fa-info-circle me-2"></i> {{ bootstrapAlertMessage }}
        <button
          type="button"
          class="btn-close"
          @click="bootstrapAlertMessage = ''"
          aria-label="Close alert"
        ></button>
      </div>

      <div
        v-if="isLoading"
        class="d-flex justify-content-center align-items-center"
        style="min-height: 80vh"
      >
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden"
            >{{ curLangText?.loading || 'Loading...' }}</span
          >
        </div>
      </div>

      <template v-if="!authenticated && !isLoading">
        <div class="row mt-4">
          <div class="col text-center">
            <h1>
              {{ curLangText?.app_title || 'Patient Intake/Output Recorder' }}
            </h1>
          </div>
        </div>
        <div class="row justify-content-center mt-4">
          <div class="col-md-6 col-lg-5 col-xl-4">
            <div class="card shadow-sm">
              <div class="card-body p-4">
                <h5 class="card-title text-center mb-4">
                  {{ curLangText?.login || 'Login' }}
                </h5>
                <div class="input-group mb-3">
                  <span class="input-group-text" id="login-account-addon"
                    ><i class="fas fa-user fa-fw"></i
                  ></span>
                  <input
                    type="text"
                    class="form-control"
                    :placeholder="curLangText?.username || 'Username'"
                    aria-label="Username"
                    aria-describedby="login-account-addon"
                    v-model.trim="account"
                    required
                  />
                </div>
                <div class="input-group mb-3">
                  <span class="input-group-text" id="login-password-addon"
                    ><i class="fas fa-lock fa-fw"></i
                  ></span>
                  <input
                    :type="showPassword ? 'text' : 'password'"
                    class="form-control"
                    :placeholder="curLangText?.password || 'Password'"
                    aria-label="Password"
                    aria-describedby="login-password-addon"
                    v-model="password"
                    required
                    @keyup.enter="authenticate"
                  />
                  <button
                    class="btn btn-light border"
                    type="button"
                    @click="togglePasswordVisibility"
                    :aria-label="showPassword ? (curLangText?.hide_password || 'Hide password') : (curLangText?.show_password || 'Show password')"
                  >
                    <i
                      class="fas fa-fw"
                      :class="showPassword ? 'fa-eye-slash' : 'fa-eye'"
                      aria-hidden="true"
                    ></i>
                  </button>
                </div>
                <div class="input-group input-group-sm mb-3">
                  <label class="input-group-text" for="login-language-select"
                    ><i class="fas fa-globe fa-fw"></i
                  ></label>
                  <select
                    id="login-language-select"
                    v-model="selectedLanguage"
                    @change="changeLanguage($event.target.value)"
                    class="form-select"
                    :aria-label="curLangText?.language_selection || 'Language Selection'"
                  >
                    <option
                      v-for="lang in supportedLanguages"
                      :key="lang.code"
                      :value="lang.code"
                    >
                      {{ lang.name }}
                    </option>
                  </select>
                </div>
                <div class="d-grid">
                  <button
                    class="btn btn-primary"
                    @click="authenticate"
                    :disabled="!account || !password"
                  >
                    <i class="fas fa-sign-in-alt me-2"></i>{{ curLangText?.login
                    || 'Login' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </template>

      <template v-else>
        <div
          class="row align-items-center mb-3 bg-light py-2 rounded shadow-sm"
        >
          <div class="col-6 col-md-4 fw-bold fs-5 text-nowrap text-secondary">
            <i class="fas fa-calendar-alt me-1"></i> {{ currentDate }}
          </div>
          <div
            class="col-6 col-md-4 offset-md-4 text-end fw-bold fs-5 text-nowrap text-secondary"
          >
            <i class="fas fa-clock me-1"></i> {{ currentTime }}
          </div>
        </div>

        <div
          v-if="restrictionText"
          class="alert alert-warning show text-center fw-bold fs-5"
          role="alert"
        >
          <i class="fas fa-exclamation-triangle me-2"></i>
          {{ restrictionText }}
        </div>

        <div
          class="row justify-content-around row-cols-2 row-cols-lg-4 g-2 mb-2"
        >
          <div class="col">
            <div class="card shadow h-100 py-2 bg-light">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col-8">
                    <h3>{{ curLangText.food_intake }}</h3>
                  </div>
                  <div class="col-4">
                    <i class="fa-solid fa-utensils" style="font-size: 24px"></i>
                  </div>
                </div>

                <div class="row">
                  <!-- dropdown -->
                  <div class="col">
                    <select
                      class="form-select"
                      aria-label="Food Intake Selection"
                      v-model="inputFood"
                    >
                      <option value="" disabled>
                        {{ curLangText.unit }}(g)
                      </option>
                      <option selected value="0">0</option>
                      <option
                        v-for="option in options"
                        :key="option.value"
                        :value="option.value"
                      >
                        {{ option.label }}
                      </option>
                      <option value="custom">{{ curLangText.custom }}</option>
                      <input
                        v-show="inputFood === 'custom'"
                        class="form-control"
                        v-model="customInputFood"
                        type="number"
                        :placeholder="`${curLangText.unit}(g)`"
                        aria-label="Custom Food Intake"
                      />
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- water -->
          <div class="col">
            <div class="card shadow h-100 py-2 bg-light">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col-8">
                    <h3>{{ curLangText.water_consumption }}</h3>
                  </div>
                  <div class="col-4">
                    <i
                      class="fa-solid fa-glass-water"
                      style="font-size: 24px"
                    ></i>
                  </div>
                </div>

                <div class="row">
                  <!-- dropdown -->
                  <div class="col">
                    <select
                      class="form-select"
                      aria-label="Water Consumption Selection"
                      v-model="inputWater"
                    >
                      <option value="" disabled>
                        {{ curLangText.unit }}(ml)
                      </option>
                      <option selected value="0">0</option>
                      <option
                        v-for="option in options"
                        :key="option.value"
                        :value="option.value"
                      >
                        {{ option.label }}
                      </option>
                      <option value="custom">{{ curLangText.custom }}</option>
                      <input
                        v-show="inputWater === 'custom'"
                        class="form-control"
                        v-model="customInputWater"
                        type="number"
                        :placeholder="`${curLangText.unit}(ml)`"
                        aria-label="Custom Water Intake"
                      />
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- urination -->
          <div class="col">
            <div class="card shadow h-100 py-2 bg-light">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col-8">
                    <h3>{{ curLangText.urination }}</h3>
                  </div>
                  <div class="col-4">
                    <i class="fa-solid fa-toilet" style="font-size: 24px"></i>
                  </div>
                </div>

                <div class="row">
                  <!-- dropdown -->
                  <div class="col">
                    <select
                      class="form-select"
                      aria-label="Urination Amount Selection"
                      v-model="inputUrination"
                    >
                      <option value="" disabled>
                        {{ curLangText.unit }}(ml)
                      </option>
                      <option selected value="0">0</option>
                      <option
                        v-for="option in options"
                        :key="option.value"
                        :value="option.value"
                      >
                        {{ option.label }}
                      </option>
                      <option value="custom">{{ curLangText.custom }}</option>
                      <input
                        v-show="inputUrination === 'custom'"
                        class="form-control"
                        v-model="customInputUrination"
                        type="number"
                        :placeholder="`${curLangText.unit}(ml)`"
                        aria-label="Custom Urination Amount"
                      />
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- defecation -->
          <div class="col">
            <div class="card shadow h-100 py-2 bg-light">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col-8">
                    <h3>{{ curLangText.defecation }}</h3>
                  </div>
                  <div class="col-4">
                    <i class="fa-solid fa-restroom" style="font-size: 24px">
                    </i>
                  </div>
                </div>

                <div class="row checkbox-row">
                  <!-- dropdown -->
                  <div class="col">
                    <select
                      class="form-select"
                      aria-label="Defecation Frequency Selection"
                      v-model="inputDefecation"
                    >
                      <option value="" disabled>
                        {{ curLangText.unit }}({{ curLangText.times }})
                      </option>
                      <option selected value="0">0</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- weight -->
        <div class="row mb-2">
          <div class="col">
            <div class="card shadow h-60 py-2 bg-light">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col-4">
                    <h3>{{ curLangText.weight }}</h3>
                  </div>
                  <div class="col-2">
                    <i
                      class="fa-solid fa-weight-scale"
                      style="font-size: 30px"
                    ></i>
                  </div>
                  <div class="col-6">
                    <div class="col">
                      <div class="form-floating">
                        <input
                          type="number"
                          class="form-control"
                          id="inputWeight"
                          v-model="inputWeight"
                        />
                        <label for="inputWeight"
                          >{{ curLangText.unit }}(kg)</label
                        >
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col text-center position-relative">
            <button
              type="button"
              class="btn btn-primary btn-lg"
              @click="addData"
              :disabled="isUpdating"
            >
              <span
                v-if="isUpdating"
                class="spinner-border spinner-border-sm me-2"
                role="status"
                aria-hidden="true"
              ></span>
              <i v-else class="fas fa-plus-circle me-2"></i>
              {{ isUpdating ? (curLangText?.saving || 'Saving...') :
              (curLangText?.create_new_record || 'Add Record') }}
            </button>
            <transition name="fade">
              <div
                v-if="showNotification"
                class="alert alert-success alert-dismissible d-inline-flex align-items-center fade show ms-3 p-2"
                role="alert"
                style="
                  position: absolute;
                  top: 50%;
                  transform: translateY(-50%);
                "
              >
                <i class="fas fa-check-circle me-2"></i>
                {{ curLangText?.data_added_successfully || 'Record Saved!' }}
                <button
                  type="button"
                  class="btn-close ms-2 p-1"
                  @click="hideNotification"
                  aria-label="Close"
                ></button>
              </div>
            </transition>
          </div>
        </div>

        <div class="row">
          <template v-if="records[currentDateYY_MM_DD]">
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead class="table-secondary">
                  <tr class="text-center">
                    <th scope="col">
                      {{ records[currentDateYY_MM_DD]['recordDate'] }}
                    </th>
                    <th scope="col">{{ curLangText.food_intake }}</th>
                    <th scope="col">{{ curLangText.water_consumption }}</th>
                    <th scope="col">{{ curLangText.urination }}</th>
                    <th scope="col">{{ curLangText.defecation }}</th>
                  </tr>
                </thead>
                <tbody class="table-group-divider">
                  <tr class="text-center fw-bold">
                    <td>{{ curLangText.sum }}</td>
                    <td :style="{ color: getFoodSumColor() }">
                      {{ records[currentDateYY_MM_DD]['foodSum'] }}
                    </td>
                    <td :style="{ color: getWaterSumColor() }">
                      {{ records[currentDateYY_MM_DD]['waterSum'] }}
                    </td>
                    <td>{{ records[currentDateYY_MM_DD]['urinationSum'] }}</td>
                    <td>{{ records[currentDateYY_MM_DD]['defecationSum'] }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </template>
          <template v-else>
            <h4 class="text-center">
              {{ curLangText.no_records_yet_for_today }}
            </h4>
          </template>
        </div>

        <!-- Records -->
        <div class="row">
          <div class="col">
            <!-- dailyRecord = record[currentDate] = curRecord  -->
            <div v-for="(dailyRecord, index) in reversedRecord">
              <div class="accordion">
                <div class="accordion-item shadow bg-light">
                  <h2 class="accordion-header" id="recordSection">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      :data-bs-target="`#content_${index}`"
                      aria-expanded="false"
                      :aria-controls="`content_${index}`"
                    >
                      <div class="row">
                        <div
                          class="col-2"
                          style="font-size: 20px; margin-left: -10px"
                        >
                          <div class="recordDate">
                            <b>{{ dailyRecord["recordDate"] }}</b>
                          </div>
                        </div>
                        <div
                          class="col-6"
                          style="font-size: 18px; margin-left: 6px"
                        >
                          <div class="weight">
                            {{ curLangText.weight }}:
                            <b
                              >{{ dailyRecord["weight"] == 'NaN' ?
                              curLangText.not_measured : dailyRecord["weight"]
                              }}</b
                            >
                          </div>
                        </div>
                        <div
                          class="col-4"
                          style="white-space: nowrap; font-size: 18px"
                        >
                          <div class="count">
                            <b>{{ dailyRecord["count"] }}</b> {{
                            curLangText.record_count }}
                          </div>
                        </div>
                      </div>
                    </button>
                  </h2>
                  <div
                    class="accordion-collapse collapse"
                    :id="`content_${index}`"
                    aria-labelledby="recordSection"
                    data-bs-parent="#accordionExample"
                  >
                    <div class="accordion-body">
                      <div class="table-responsive">
                        <table
                          class="table table-hover table-bordered"
                          style="font-size: 18px"
                        >
                          <thead class="table-secondary">
                            <tr class="text-center">
                              <th scope="col">{{ curLangText.timestamp }}</th>
                              <th scope="col">{{ curLangText.food_intake }}</th>
                              <th scope="col">
                                {{ curLangText.water_consumption }}
                              </th>
                              <th scope="col">{{ curLangText.urination }}</th>
                              <th scope="col">{{ curLangText.defecation }}</th>
                              <th scope="col"></th>
                            </tr>
                          </thead>
                          <tbody class="table-group-divider">
                            <tr
                              v-for="(data, index2) in dailyRecord['data']"
                              :key="index2"
                            >
                              <td v-for="content in data" class="text-center">
                                {{ content }}
                              </td>
                              <td
                                class="justify-content-center align-items-center"
                                style="text-align: center"
                              >
                                <i
                                  @click="removeRecord($event.target)"
                                  :id="`${index}-${index2}`"
                                  class="fa-solid"
                                  :class="removingRecord ? 'fa-hourglass-half' : 'fa-trash-can'"
                                >
                                </i>
                              </td>
                            </tr>
                            <tr class="table-light text-center fw-bold">
                              <td>{{ curLangText.sum }}</td>
                              <td>{{ dailyRecord["foodSum"] }}</td>
                              <td>{{ dailyRecord["waterSum"] }}</td>
                              <td>{{ dailyRecord["urinationSum"] }}</td>
                              <td>{{ dailyRecord["defecationSum"] }}</td>
                              <td></td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row align-items-center mt-3 pb-5">
          <div class="col-md-4 col-lg-3">
            <div class="input-group input-group-sm">
              <label class="input-group-text" for="main-language-select"
                ><i class="fas fa-globe fa-fw"></i
              ></label>
              <select
                id="main-language-select"
                v-model="selectedLanguage"
                @change="changeLanguage($event.target.value)"
                class="form-select"
                :aria-label="curLangText?.language_selection || 'Language Selection'"
              >
                <option
                  v-for="lang in supportedLanguages"
                  :key="`main-${lang.code}`"
                  :value="lang.code"
                >
                  {{ lang.name }}
                </option>
              </select>
            </div>
          </div>
          <div class="col-md-8 col-lg-9 text-md-end mt-2 mt-md-0">
            <span class="me-3 text-muted"
              ><i class="fas fa-user-circle me-1"></i> {{ curLangText?.username
              || 'Username' }}: {{ account }}</span
            >
            <button
              class="btn btn-sm btn-outline-danger"
              @click="confirmLogout"
            >
              <i class="fas fa-sign-out-alt me-1"></i> {{ curLangText?.logout ||
              'Logout' }}
            </button>
          </div>
        </div>

        <button
          class="btn btn-dark position-fixed bottom-0 end-0 m-3 rounded-circle shadow"
          style="
            width: 40px;
            height: 40px;
            line-height: 1;
            padding: 0;
            z-index: 1030;
          "
          id="scrollToTopBtn"
          @click="scrollToTop"
          v-show="showScrollButton"
          :title="curLangText?.scroll_to_top || 'Scroll to Top'"
        >
          <i class="fa-solid fa-arrow-up"></i>
        </button>

        <div
          class="modal fade"
          id="confirmModal"
          tabindex="-1"
          data-bs-backdrop="static"
          aria-labelledby="confirmModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">
                  <i class="fas fa-question-circle me-2 text-warning"></i>{{
                  curLangText?.confirm_action || 'Confirm Action' }}
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                  @click="handleConfirm(false)"
                ></button>
              </div>
              <div class="modal-body">
                <p style="white-space: pre-wrap">{{ confirmMessage }}</p>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                  @click="handleConfirm(false)"
                >
                  {{ curLangText?.cancel || 'Cancel' }}
                </button>
                <button
                  type="button"
                  class="btn btn-danger"
                  data-bs-dismiss="modal"
                  @click="handleConfirm(true)"
                >
                  {{ curLangText?.confirm || 'Confirm' }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </template>

      <footer
        v-if="!authenticated"
        class="footer py-3 bg-white fixed-bottom border-top"
      >
        <div class="container text-center text-md-start">
          <div class="row align-items-center">
            <div class="col-md-5 text-muted small">
              © 2023–2025 LifeAdventurer | All rights reserved
            </div>
            <div class="col-md-3 text-muted small">
              Code licensed
              <a
                href="https://github.com/LifeAdventurer/patient-intake-output-recorder/blob/main/LICENSE"
                target="_blank"
                rel="noopener noreferrer"
                >GPL-3.0</a
              >
            </div>
            <div class="col-md-2 text-muted small">
              Version: <strong>v1.2.0</strong>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.5.12/vue.global.min.js"
      integrity="sha512-GQnkp3HbW6BBv2mlZ7ZmzEfJcoaTJSMKBjORQCknW8HbkyV5gmJKSpDp1LLXdJDaZg+pH4/Hx5isR8Eyx6YYsQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"
      integrity="sha512-2rNj2KJ+D8s1ceNasTIex6z4HWyOnEYLVC3FigGOmyQCZc2eBXKgOxQmo3oKLHyfcj53uz4QMsRCWNbLd32Q1g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js"
      integrity="sha512-ykZ1QQr0Jy/4ZkvKuqWn4iF3lqPZyij9iRv6sGqLRdTPkY69YX6+7wvVGmsdBbiIfN/8OdsI7HABjvEok6ZopQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script src="./script.js"></script>
  </body>
</html>
